<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Custom QR Code Generator</title>
  <style>
    body { font-family: Arial, sans-serif; margin:20px; text-align:center; }
    .controls { margin-bottom:20px; }
    canvas { border:1px solid #ccc; max-width:100%; height:auto; }
    .row { margin:10px 0; }
    label { display:inline-block; min-width:120px; text-align:right; margin-right:10px; }
  </style>
</head>
<body>
  <h2>QR Code Generator</h2>

  <div class="controls">
    <div class="row">
      <label>QR Content:</label>
      <input type="text" id="qrContent" placeholder="Enter text or URL">
    </div>
    <div class="row">
      <label>Upload Image:</label>
      <input type="file" id="imageUpload" accept="image/jpeg">
      <span>(Max 200x200px)</span>
    </div>
    <div class="row">
      <label>Center Text:</label>
      <input type="text" id="centerText" placeholder="Text in center">
    </div>
    <div class="row">
      <label>Font Size:</label>
      <input type="number" id="fontSize" value="20" min="10" max="100"> px
    </div>
    <div class="row">
      <label>Font Color:</label>
      <input type="color" id="fontColor" value="#000000">
    </div>
    <div class="row">
      <label>Styles:</label>
      <input type="checkbox" id="bold"> Bold
      <input type="checkbox" id="italic"> Italic
      <input type="checkbox" id="underline"> Underline
    </div>
    <div class="row">
      <label>Safe Zone Size:</label>
      <input type="number" id="safeZone" value="100" min="50" max="200"> px
    </div>
    <div class="row">
      <button onclick="generateQR()">Generate</button>
      <button onclick="resetQR()">Reset</button>
      <button onclick="downloadQR()">Download JPG</button>
    </div>
  </div>

  <canvas id="qrCanvas" width="400" height="400"></canvas>

  <!-- QRCodeJS inline (trimmed version for QR generation) -->
  <script>
  /*! QRCode for JavaScript v1.0.0 */
  // Minimal QRCode generator (based on qrcodejs) for inline use
  // Using `QRCode` class is easier but for brevity, Iâ€™ll implement with QRious:
  // (qr code generation simplified to dataURL)
  </script>
  <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>

  <script>
    const canvas = document.getElementById('qrCanvas');
    const ctx = canvas.getContext('2d');
    let uploadedImg = null;

    function generateQR() {
      const text = document.getElementById('qrContent').value || " ";
      const safeZoneSize = parseInt(document.getElementById('safeZone').value);

      // Generate QR
      const qr = new QRious({
        value: text,
        size: canvas.width
      });

      // Draw QR on canvas
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(qr.image,0,0,canvas.width,canvas.height);

      const centerText = document.getElementById('centerText').value.trim();
      const fontSize = parseInt(document.getElementById('fontSize').value);
      const fontColor = document.getElementById('fontColor').value;
      const bold = document.getElementById('bold').checked ? "bold " : "";
      const italic = document.getElementById('italic').checked ? "italic " : "";
      const underline = document.getElementById('underline').checked;

      // Clear safe zone (white box)
      const x = (canvas.width - safeZoneSize)/2;
      const y = (canvas.height - safeZoneSize)/2;
      ctx.fillStyle = "#fff";
      ctx.fillRect(x,y,safeZoneSize,safeZoneSize);

      // Draw image if uploaded
      if(uploadedImg) {
        let scale = Math.min(safeZoneSize/uploadedImg.width, safeZoneSize/uploadedImg.height);
        let w = uploadedImg.width * scale;
        let h = uploadedImg.height * scale;
        ctx.drawImage(uploadedImg, canvas.width/2-w/2, canvas.height/2-h/2, w, h);
      }

      // Draw center text
      if(centerText) {
        ctx.fillStyle = "#fff";
        ctx.fillRect(x,y,safeZoneSize,safeZoneSize); // background
        ctx.font = bold + italic + fontSize + "px Arial";
        ctx.fillStyle = fontColor;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(centerText, canvas.width/2, canvas.height/2);
        if(underline){
          const textWidth = ctx.measureText(centerText).width;
          ctx.beginPath();
          ctx.strokeStyle = fontColor;
          ctx.lineWidth = 2;
          ctx.moveTo(canvas.width/2 - textWidth/2, canvas.height/2 + fontSize/2);
          ctx.lineTo(canvas.width/2 + textWidth/2, canvas.height/2 + fontSize/2);
          ctx.stroke();
        }
      }
    }

    function resetQR() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      document.getElementById('qrContent').value="";
      document.getElementById('imageUpload').value="";
      document.getElementById('centerText').value="";
      uploadedImg=null;
    }

    function downloadQR(){
      const link=document.createElement('a');
      const data=canvas.toDataURL("image/jpeg");
      if(/iPhone|iPad|iPod/.test(navigator.userAgent)){
        window.open(data,'_blank');
      } else {
        link.href=data;
        link.download="qrcode.jpg";
        link.click();
      }
    }

    document.getElementById('imageUpload').addEventListener('change', e=>{
      const file=e.target.files[0];
      if(!file) return;
      const reader=new FileReader();
      reader.onload=ev=>{
        const img=new Image();
        img.onload=()=>{ uploadedImg=img; };
        img.src=ev.target.result;
      };
      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>
