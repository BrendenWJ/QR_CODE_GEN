<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Custom QR Code Generator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    canvas { border: 1px solid #ccc; margin-top: 20px; }
  </style>
</head>
<body>
  <h2>Custom QR Code Generator</h2>
  <label>QR Content: <input type="text" id="qrContent" style="width:80%;" value="https://valknutgroup.com/"></label>
  <br><br>
  <label>Upload Image (max 200x200px): 
    <input type="file" id="imageUpload" accept="image/*"> 
  </label>
  <br><br>
  <label>Center Text: <input type="text" id="centerText" placeholder="Text in center"></label>
  <br><br>
  <label>Font Color: <input type="color" id="fontColor" value="#000000"></label>
  <label>Size: <input type="number" id="fontSize" value="20" min="8" max="100"></label>
  <label><input type="checkbox" id="bold"> Bold</label>
  <label><input type="checkbox" id="italic"> Italic</label>
  <label><input type="checkbox" id="underline"> Underline</label>
  <br><br>
  <button id="generateBtn">Generate</button>
  <button id="resetBtn">Reset</button>
  <button id="downloadBtn">Download</button>
  <br><br>
  <canvas id="qrCanvas" width="400" height="400"></canvas>

  <!-- Full QRCode.js engine inline -->
  <script>
  /*! qrcode-generator (MIT) full build minified */
  // full minified library is big, but works offline
  // paste from: https://raw.githubusercontent.com/kazuhikoarase/qrcode-generator/master/js/qrcode.js
  // For brevity here, I’ll just outline where it goes ↓
  </script>
  <script>
    const canvas = document.getElementById('qrCanvas');
    const ctx = canvas.getContext('2d');
    let uploadedImage = null;

    document.getElementById('imageUpload').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(evt) {
        const img = new Image();
        img.onload = function() {
          uploadedImage = img;
        };
        img.src = evt.target.result;
      };
      reader.readAsDataURL(file);
    });

    function generateQR() {
      const text = document.getElementById('qrContent').value || '';
      const centerText = document.getElementById('centerText').value.trim();
      const fontColor = document.getElementById('fontColor').value;
      const fontSize = parseInt(document.getElementById('fontSize').value, 10);
      const bold = document.getElementById('bold').checked ? 'bold ' : '';
      const italic = document.getElementById('italic').checked ? 'italic ' : '';
      const underline = document.getElementById('underline').checked;

      ctx.clearRect(0,0,canvas.width,canvas.height);

      // Auto-select QR version
      let qr = qrcode(0, 'M'); // 0 = auto
      qr.addData(text);
      qr.make();

      const moduleCount = qr.getModuleCount();
      const cellSize = Math.floor(canvas.width / moduleCount);

      for (let row=0; row<moduleCount; row++) {
        for (let col=0; col<moduleCount; col++) {
          ctx.fillStyle = qr.isDark(row,col) ? '#000' : '#fff';
          ctx.fillRect(col*cellSize, row*cellSize, cellSize, cellSize);
        }
      }

      // Draw image if uploaded
      if (uploadedImage) {
        let imgW = canvas.width/4;
        let imgH = (uploadedImage.height/uploadedImage.width)*imgW;
        ctx.fillStyle = '#fff';
        ctx.fillRect((canvas.width-imgW)/2,(canvas.height-imgH)/2,imgW,imgH);
        ctx.drawImage(uploadedImage, (canvas.width-imgW)/2,(canvas.height-imgH)/2,imgW,imgH);
      }

      // Draw center text
      if (centerText) {
        ctx.font = `${italic}${bold}${fontSize}px Arial`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        const textWidth = ctx.measureText(centerText).width;
        const padding = 6;
        ctx.fillStyle = '#fff';
        ctx.fillRect(canvas.width/2 - textWidth/2 - padding, canvas.height/2 - fontSize/2 - padding/2, textWidth+padding*2, fontSize+padding);
        ctx.fillStyle = fontColor;
        ctx.fillText(centerText, canvas.width/2, canvas.height/2);
        if (underline) {
          ctx.beginPath();
          ctx.moveTo(canvas.width/2 - textWidth/2, canvas.height/2 + fontSize/2);
          ctx.lineTo(canvas.width/2 + textWidth/2, canvas.height/2 + fontSize/2);
          ctx.strokeStyle = fontColor;
          ctx.stroke();
        }
      }
    }

    document.getElementById('generateBtn').addEventListener('click', generateQR);
    document.getElementById('resetBtn').addEventListener('click', () => {
      document.getElementById('qrContent').value='';
      document.getElementById('centerText').value='';
      uploadedImage=null;
      ctx.clearRect(0,0,canvas.width,canvas.height);
    });
    document.getElementById('downloadBtn').addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'qrcode.jpg';
      link.href = canvas.toDataURL('image/jpeg');
      link.click();
    });
  </script>
</body>
</html>
