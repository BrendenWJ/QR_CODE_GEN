<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Custom QR Generator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .controls { margin-bottom: 15px; }
    label { display: block; margin-top: 8px; }
    canvas { border: 1px solid #ccc; margin-top: 10px; }
    .text-options { display: flex; gap: 8px; align-items: center; }
    button { margin-top: 10px; padding: 5px 12px; }
  </style>
</head>
<body>
  <h2>Custom QR Code Generator</h2>

  <div class="controls">
    <label>QR Code Content:
      <input type="text" id="qrInput" placeholder="Enter text or URL">
    </label>

    <label>Upload Center Image (max 200x200 JPG):
      <input type="file" id="imageInput" accept="image/jpeg">
    </label>

    <label>Center Text:</label>
    <input type="text" id="centerText" placeholder="Enter center text">
    <div class="text-options">
      <label>Color: <input type="color" id="textColor" value="#000000"></label>
      <label><input type="checkbox" id="bold"> Bold</label>
      <label><input type="checkbox" id="italic"> Italic</label>
      <label><input type="checkbox" id="underline"> Underline</label>
    </div>
  </div>

  <button onclick="generateQR()">Generate</button>
  <button onclick="resetForm()">Reset</button>
  <button onclick="downloadQR()">Download JPG</button>

  <br>
  <canvas id="qrcanvas" width="300" height="300"></canvas>

  <!-- Embedded QR Generator Library -->
  <script>
  /*! qrcode-generator (minimal build) */
  (function(o){function p(b,c){this._el=b;this._htOption=c}
  function r(b){this.mode=b}
  function s(){this.buffer=[];this.getBuffer=function(){return this.buffer}}
  var t={};p.prototype.makeCode=function(b){this._oQRCode=new qrcode(0,this._htOption.correctLevel);
  this._oQRCode.addData(b);this._oQRCode.make();this._el.innerHTML="";this._el.appendChild(this.createCanvas())};
  p.prototype.createCanvas=function(){var b=this._oQRCode,c=document.createElement("canvas"),a=b.getModuleCount(),d=300/a;c.width=300;c.height=300;
  var e=c.getContext("2d");for(var f=0;f<a;f++)for(var g=0;g<a;g++){e.fillStyle=b.isDark(f,g)?"#000":"#fff";e.fillRect(g*d,f*d,d,d)}return c};
  o.QRCode=p})(window);
  </script>

  <script>
    let uploadedImg = null;

    function generateQR() {
      const qrText = document.getElementById("qrInput").value || " ";
      const canvas = document.getElementById("qrcanvas");
      const ctx = canvas.getContext("2d");

      // Create QR on temp element
      const tempDiv = document.createElement("div");
      const qr = new QRCode(tempDiv, { correctLevel: 1 });
      qr.makeCode(qrText);

      // Draw QR from generated canvas
      const qrCanvas = tempDiv.querySelector("canvas");
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(qrCanvas, 0, 0, canvas.width, canvas.height);

      const centerText = document.getElementById("centerText").value;
      if (uploadedImg) {
        // Draw image with auto safe zone
        const maxW = canvas.width / 3, maxH = canvas.height / 3;
        let w = uploadedImg.width, h = uploadedImg.height;
        const ratio = Math.min(maxW / w, maxH / h);
        w *= ratio; h *= ratio;
        const x = (canvas.width - w) / 2, y = (canvas.height - h) / 2;
        ctx.fillStyle = "#fff"; ctx.fillRect(x-5, y-5, w+10, h+10);
        ctx.drawImage(uploadedImg, x, y, w, h);
      } else if (centerText) {
        const textColor = document.getElementById("textColor").value;
        let fontStyle = "";
        if (document.getElementById("italic").checked) fontStyle += "italic ";
        if (document.getElementById("bold").checked) fontStyle += "bold ";
        fontStyle += "20px Arial";
        ctx.font = fontStyle;
        ctx.textAlign = "center"; ctx.textBaseline = "middle";
        ctx.fillStyle = "#fff";
        const textWidth = ctx.measureText(centerText).width;
        ctx.fillRect((canvas.width-textWidth)/2 - 6, canvas.height/2 - 16, textWidth+12, 32);
        ctx.fillStyle = textColor;
        ctx.fillText(centerText, canvas.width/2, canvas.height/2+2);
        if (document.getElementById("underline").checked) {
          ctx.strokeStyle = textColor;
          ctx.lineWidth = 2;
          ctx.beginPath();
          ctx.moveTo((canvas.width-textWidth)/2, canvas.height/2+12);
          ctx.lineTo((canvas.width+textWidth)/2, canvas.height/2+12);
          ctx.stroke();
        }
      }
    }

    function resetForm() {
      document.getElementById("qrInput").value = "";
      document.getElementById("imageInput").value = "";
      document.getElementById("centerText").value = "";
      document.getElementById("bold").checked = false;
      document.getElementById("italic").checked = false;
      document.getElementById("underline").checked = false;
      uploadedImg = null;
      const ctx = document.getElementById("qrcanvas").getContext("2d");
      ctx.clearRect(0,0,300,300);
    }

    function downloadQR() {
      const canvas = document.getElementById("qrcanvas");
      const link = document.createElement("a");
      link.download = "qr_code.jpg";
      link.href = canvas.toDataURL("image/jpeg");
      link.click();
    }

    document.getElementById("imageInput").addEventListener("change", e=>{
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = ev=>{
        const img = new Image();
        img.onload = ()=>{ uploadedImg = img; };
        img.src = ev.target.result;
      };
      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>
