<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Code Generator</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    .container { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-width: 500px; margin: auto; }
    .row { margin-bottom: 15px; }
    label { display: block; font-weight: bold; margin-bottom: 6px; }
    input[type=text], input[type=file], select, input[type=color], input[type=number] { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 6px; }
    canvas { display: block; margin: 20px auto; border: 1px solid #ddd; }
    button { padding: 10px 20px; border: none; border-radius: 8px; background: #007bff; color: #fff; cursor: pointer; margin-right: 8px; }
    button:hover { background: #0056b3; }
  </style>
</head>
<body>
  <div class="container">
    <h2>QR Code Generator</h2>

    <div class="row">
      <label for="qrText">QR Code Content</label>
      <input type="text" id="qrText" placeholder="Enter text or URL">
    </div>

    <div class="row">
      <label for="centerImage">Upload Center Image (JPG)</label>
      <input type="file" id="centerImage" accept="image/jpeg">
    </div>

    <div class="row">
      <label for="centerText">Center Text</label>
      <input type="text" id="centerText" placeholder="Enter overlay text">
      <label>Font Size:</label>
      <select id="fontSize">
        <option value="16">16px</option>
        <option value="24">24px</option>
        <option value="32">32px</option>
        <option value="48">48px</option>
      </select>
      <label>Font Color:</label>
      <input type="color" id="fontColor" value="#000000">
    </div>

    <div class="row">
      <label for="zoneSize">Center Zone Size (px)</label>
      <input type="number" id="zoneSize" value="80" min="40" max="200">
    </div>

    <div class="row">
      <button onclick="generateQR()">Generate QR Code</button>
      <button onclick="downloadQR()">Download JPG</button>
      <button onclick="resetQR()">Reset</button>
    </div>

    <canvas id="qrCanvas" width="300" height="300"></canvas>
  </div>

  <!-- QRCode.js library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>
    let uploadedImage = null;

    document.getElementById('centerImage').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file && file.type === 'image/jpeg') {
        const img = new Image();
        img.onload = () => {
          uploadedImage = img;
        };
        img.src = URL.createObjectURL(file);
      }
    });

    function generateQR() {
      const qrText = document.getElementById('qrText').value;
      const centerText = document.getElementById('centerText').value;
      const fontSize = document.getElementById('fontSize').value;
      const fontColor = document.getElementById('fontColor').value;
      const zoneSize = parseInt(document.getElementById('zoneSize').value);

      const canvas = document.getElementById('qrCanvas');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const hasOverlay = centerText || uploadedImage;

      // Generate QR to hidden div
      const tempDiv = document.createElement('div');
      const qr = new QRCode(tempDiv, {
        text: qrText || ' ',
        width: 300,
        height: 300,
        margin: 1
      });

      setTimeout(() => {
        const qrImg = tempDiv.querySelector('img');
        if (qrImg) {
          const qrImage = new Image();
          qrImage.onload = () => {
            ctx.drawImage(qrImage, 0, 0, 300, 300);

            if (hasOverlay) {
              // Draw shaded zone preview
              const zoneX = (canvas.width - zoneSize) / 2;
              const zoneY = (canvas.height - zoneSize) / 2;
              ctx.fillStyle = "rgba(255,255,255,0.8)";
              ctx.fillRect(zoneX, zoneY, zoneSize, zoneSize);

              // Draw text if provided
              if (centerText) {
                ctx.font = `${fontSize}px Arial`;
                ctx.fillStyle = fontColor;
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillText(centerText, canvas.width / 2, canvas.height / 2);
              }

              // Draw image if provided
              if (uploadedImage) {
                let imgW = uploadedImage.width;
                let imgH = uploadedImage.height;
                const scale = Math.min(zoneSize / imgW, zoneSize / imgH);
                imgW *= scale;
                imgH *= scale;
                const x = (canvas.width - imgW) / 2;
                const y = (canvas.height - imgH) / 2;
                ctx.drawImage(uploadedImage, x, y, imgW, imgH);
              }
            }
          };
          qrImage.src = qrImg.src;
        }
      }, 200);
    }

    function downloadQR() {
      const canvas = document.getElementById('qrCanvas');
      const link = document.createElement('a');
      link.download = 'qrcode.jpg';
      link.href = canvas.toDataURL('image/jpeg');
      link.click();
    }

    function resetQR() {
      document.getElementById('qrText').value = '';
      document.getElementById('centerText').value = '';
      document.getElementById('fontSize').value = '16';
      document.getElementById('fontColor').value = '#000000';
      document.getElementById('centerImage').value = '';
      document.getElementById('zoneSize').value = '80';
      uploadedImage = null;
      const canvas = document.getElementById('qrCanvas');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
  </script>
</body>
</html>